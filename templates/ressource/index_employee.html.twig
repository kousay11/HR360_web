{% extends 'baseEMP.html.twig' %}

{% block title %}Liste des Ressources{% endblock %}

{% block css %}
  {{ parent() }}
  <style>
    :root {
      --primary-color: #3498db;
      --success-color: #2ecc71;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --secondary-color: #7f8c8d;
    }

    .ressources-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
      padding: 1rem;
    }

    .ressource-card {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .ressource-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .ressource-img-container {
      height: 200px;
      background-color: #f8f9fa;
      position: relative;
      overflow: hidden;
    }

    .ressource-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .ressource-card:hover .ressource-img {
      transform: scale(1.05);
    }

    .fallback-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .fallback-content.show {
      opacity: 1;
    }

    .ressource-body {
      padding: 1.5rem;
      flex-grow: 1;
    }

    .ressource-title {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
      color: #2c3e50;
      font-weight: 600;
    }

    .ressource-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .ressource-badge {
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .ressource-type {
      background: var(--primary-color);
      color: white;
    }

    .ressource-etat {
      background: var(--success-color);
      color: white;
    }

    .ressource-etat.indisponible {
      background: var(--danger-color);
    }

    .ressource-prix {
      font-weight: 700;
      color: var(--warning-color);
      font-size: 1.25rem;
      margin: 0.5rem 0;
    }

    .ressource-footer {
      padding: 0 1.5rem 1.5rem;
      text-align: right;
    }

    .btn-reserver {
      background: var(--primary-color);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      text-decoration: none;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    .btn-reserver:hover {
      background: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(41, 128, 185, 0.3);
    }

    .btn-reserver.disabled {
      background: #bdc3c7;
      cursor: not-allowed;
      opacity: 0.7;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      grid-column: 1 / -1;
    }

    .empty-state i {
      font-size: 4rem;
      color: #bdc3c7;
      margin-bottom: 1rem;
    }

    @media (max-width: 768px) {
      .ressources-grid {
        grid-template-columns: 1fr;
      }
      
      .ressource-img-container {
        height: 150px;
      }
    }
  </style>
{% endblock %}

{% block index %}
    {% set resource_config = {
        'salle': {
            'image': 'salle.jpg',
            'icon': 'building',
            'color': 'primary'
        },
        'materiel': {
            'image': 'materiel.jpg',
            'icon': 'tools',
            'color': 'success'
        },
        'ordinateur': {
            'image': 'ordinateur.jpg',
            'icon': 'pc-display',
            'color': 'info'
        },
        'vehicule': {
            'image': 'vehicule.jpg',
            'icon': 'truck',
            'color': 'warning'
        }
    } %}

    <section id="portfolio" class="portfolio section">
        <div class="container section-title" data-aos="fade-up">
            <h2>Nos Ressources</h2>
            <p>Découvrez toutes nos ressources disponibles</p>
        </div>

        <div class="container">
            <div class="ressources-grid">
                {% for ressource in ressources %}
                    {% set config = resource_config[ressource.type] ?? {
                        'image': 'default.jpg',
                        'icon': 'box',
                        'color': 'secondary'
                    } %}
                    
                    <div class="ressource-card" data-aos="fade-up" data-aos-delay="{{ loop.index * 50 }}">
                        <div class="ressource-img-container">
                            <img src="{{ asset('img/ressources/' ~ config.image) }}"
                                 alt="{{ ressource.nom }}"
                                 class="ressource-img"
                                 loading="lazy"
                                 onerror="this.classList.add('error'); document.querySelector('.fallback-content').classList.add('show')">

                            <div class="fallback-content bg-{{ config.color }}">
                                <i class="bi bi-{{ config.icon }}"></i>
                            </div>
                        </div>

                        <div class="ressource-body">
                            <h3 class="ressource-title">{{ ressource.nom }}</h3>
                            <div class="ressource-meta">
  <div class="meta-item">
    <i class="bi bi-tag"></i>
    <span>{{ ressource.type }}</span>
  </div>
  <div class="meta-item">
    <i class="bi bi-circle-fill {{ ressource.etat == 'Disponible' ? 'text-success' : 'text-danger' }}"></i>
    <span>{{ ressource.etat }}</span>
  </div>
</div>
                            <p class="ressource-prix">{{ ressource.prix|number_format(3, '.', ' ') }} DT</p>
                        </div>

                        <div class="ressource-footer">
                            <a href="{{ ressource.etat == 'Disponible' ? path('app_reservation_new', {'ressourceId': ressource.id}) : '#' }}" 
                               class="btn-reserver {{ ressource.etat != 'Disponible' ? 'disabled' : '' }}"
                               {% if ressource.etat != 'Disponible' %} 
                                   aria-disabled="true"
                                   data-bs-toggle="tooltip" 
                                   title="Ressource indisponible"
                               {% endif %}>
                                <i class="bi bi-calendar-plus"></i>
                                Réserver
                            </a>
                        </div>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="bi bi-inboxes"></i>
                        <h3>Aucune ressource disponible</h3>
                        <p>Veuillez vérifier ultérieurement</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>
{% endblock %}

{% block js %}
  {{ parent() }}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialisation des tooltips Bootstrap
      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
      tooltipTriggerList.map(t => new bootstrap.Tooltip(t))

      // Gestion des erreurs d'image
      document.querySelectorAll('.ressource-img').forEach(img => {
        if (img.naturalWidth === 0) {
          img.classList.add('error')
          img.nextElementSibling.classList.add('show')
        }
      })

      // Gestion du clic sur les boutons désactivés
      document.querySelectorAll('.btn-reserver.disabled').forEach(btn => {
        btn.addEventListener('click', e => {
          e.preventDefault()
          const toast = new bootstrap.Toast(document.getElementById('errorToast'))
          toast.show()
        })
      })

      // Initialisation AOS
      if (typeof AOS !== 'undefined') {
        AOS.init({
          duration: 800,
          easing: 'ease-out-quad',
          once: true,
          offset: 50
        })
      }
    })
  </script>
{% endblock %}